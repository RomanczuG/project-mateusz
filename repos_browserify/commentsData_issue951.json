[
  {
    "url": "https://api.github.com/repos/browserify/browserify/issues/comments/59468280",
    "html_url": "https://github.com/browserify/browserify/issues/951#issuecomment-59468280",
    "issue_url": "https://api.github.com/repos/browserify/browserify/issues/951",
    "id": 59468280,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NDY4Mjgw",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-10-17T05:33:03Z",
    "updated_at": "2014-10-17T05:33:03Z",
    "author_association": "NONE",
    "body": "Thanks for doing the regression! I would have expected that maybe the 5.13.1 -> 6.0.0 jump could have introduced something like this since it uses relative paths in source maps now and if a build has symlinks to locally-linked packages that might have been the problem, so strange to see this in the 5.10.1 -> 5.11.0 jump.\n\nHere's what changed between 5.10.1 and 5.11.0:\n\n```\n$ git show 5.10.1..5.11.0\ncommit 27727a4466c4ab3a8b7e20a3772d6586f8f2cef7\nAuthor: James Halliday <mail@substack.net>\nDate:   Thu Aug 28 15:35:43 2014 -0700\n\n    5.11.0\n\ndiff --git a/changelog.markdown b/changelog.markdown\nindex 71b7b76..7c91a0e 100644\n--- a/changelog.markdown\n+++ b/changelog.markdown\n@@ -1,3 +1,8 @@\n+# 5.11.0\n+\n+adds an implicit dependency on the original module during dedupe\n+https://github.com/substack/node-browserify/pull/880\n+\n # 5.10.1\n\n fixes the command-line client to properly ignore paths that don't match a glob\ndiff --git a/package.json b/package.json\nindex 0898f87..5b66c2d 100644\n--- a/package.json\n+++ b/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"browserify\",\n-  \"version\": \"5.10.1\",\n+  \"version\": \"5.11.0\",\n   \"description\": \"browser-side require() the node way\",\n   \"main\": \"index.js\",\n   \"bin\": {\n\ncommit 67e74bdb304abb17bba5b02af6ef53e1cd40fa18\nAuthor: James Halliday <mail@substack.net>\nDate:   Thu Aug 28 15:34:43 2014 -0700\n\n    also check for indexDeps\n\ndiff --git a/index.js b/index.js\nindex ea036e6..18e7afb 100644\n--- a/index.js\n+++ b/index.js\n@@ -475,7 +475,7 @@ Browserify.prototype._dedupe = function () {\n             ;\n             row.nomap = true;\n         }\n-        if (row.dedupeIndex && row.dedupe) {\n+        if (row.dedupeIndex && row.dedupe && row.indexDeps) {\n             row.indexDeps[row.dedupe] = row.dedupeIndex;\n         }\n         this.push(row);\n\ncommit 463637132d1046a55316612e42f3c46329e48f2a\nAuthor: John Gozde <john@gozde.ca>\nDate:   Thu Aug 28 11:33:28 2014 -0600\n\n    Add implicit dep on original source during dedupe.\n\n    This presents a more accurate representation of the resulting\n    dependency graph.\n\ndiff --git a/index.js b/index.js\nindex b109b94..ea036e6 100644\n--- a/index.js\n+++ b/index.js\n@@ -475,6 +475,9 @@ Browserify.prototype._dedupe = function () {\n             ;\n             row.nomap = true;\n         }\n+        if (row.dedupeIndex && row.dedupe) {\n+            row.indexDeps[row.dedupe] = row.dedupeIndex;\n+        }\n         this.push(row);\n         next();\n     });\ndiff --git a/test/dedupe-deps.js b/test/dedupe-deps.js\nnew file mode 100644\nindex 0000000..bcc3ae2\n--- /dev/null\n+++ b/test/dedupe-deps.js\n@@ -0,0 +1,22 @@\n+var browserify = require('../');\n+var test = require('tap').test;\n+\n+test('identical content gets deduped and the row gets an implicit dep on the original source', function (t) {\n+  t.plan(1)\n+\n+  var rows = [];\n+  browserify()\n+    .on('dep', [].push.bind(rows))\n+    .require(require.resolve('./dup'), { entry: true })\n+    .bundle(check);\n+\n+  function check(err, src) {\n+    if (err) return t.fail(err);\n+    var deduped = rows.filter(function (x) { return x.dedupeIndex });\n+    var d = deduped[0];\n+    var deps = {};\n+    deps[d.dedupe] = d.dedupeIndex;\n+\n+    t.deepEqual(d.deps, deps, \"adds implicit dep\");\n+  }\n+})\n```\n\nNot very much! So it's either:\n\n```\n-        if (row.dedupeIndex && row.dedupe) {\n+        if (row.dedupeIndex && row.dedupe && row.indexDeps) {\n```\n\nbut that just checks for the existing of indexDeps on `row` before indexing into it or it's:\n\n```\n+        if (row.dedupeIndex && row.dedupe) {\n+            row.indexDeps[row.dedupe] = row.dedupeIndex;\n+        }\n```\n\nfrom https://github.com/substack/node-browserify/pull/880\n",
    "reactions": {
      "url": "https://api.github.com/repos/browserify/browserify/issues/comments/59468280/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/browserify/browserify/issues/comments/63127752",
    "html_url": "https://github.com/browserify/browserify/issues/951#issuecomment-63127752",
    "issue_url": "https://api.github.com/repos/browserify/browserify/issues/951",
    "id": 63127752,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMTI3NzUy",
    "user": {
      "login": "jessetane",
      "id": 452396,
      "node_id": "MDQ6VXNlcjQ1MjM5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/452396?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jessetane",
      "html_url": "https://github.com/jessetane",
      "followers_url": "https://api.github.com/users/jessetane/followers",
      "following_url": "https://api.github.com/users/jessetane/following{/other_user}",
      "gists_url": "https://api.github.com/users/jessetane/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jessetane/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jessetane/subscriptions",
      "organizations_url": "https://api.github.com/users/jessetane/orgs",
      "repos_url": "https://api.github.com/users/jessetane/repos",
      "events_url": "https://api.github.com/users/jessetane/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jessetane/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-11-14T20:56:53Z",
    "updated_at": "2014-11-14T20:56:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm also seeing full paths leaking into my builds (with browserify v6.3.2) - this seems to be the offending commit:\n\nhttps://github.com/substack/node-browserify/commit/463637132d1046a55316612e42f3c46329e48f2a\n\n@jgoz any idea what the problem could be?\n",
    "reactions": {
      "url": "https://api.github.com/repos/browserify/browserify/issues/comments/63127752/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/browserify/browserify/issues/comments/63144560",
    "html_url": "https://github.com/browserify/browserify/issues/951#issuecomment-63144560",
    "issue_url": "https://api.github.com/repos/browserify/browserify/issues/951",
    "id": 63144560,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMTQ0NTYw",
    "user": {
      "login": "jgoz",
      "id": 132233,
      "node_id": "MDQ6VXNlcjEzMjIzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/132233?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jgoz",
      "html_url": "https://github.com/jgoz",
      "followers_url": "https://api.github.com/users/jgoz/followers",
      "following_url": "https://api.github.com/users/jgoz/following{/other_user}",
      "gists_url": "https://api.github.com/users/jgoz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jgoz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jgoz/subscriptions",
      "organizations_url": "https://api.github.com/users/jgoz/orgs",
      "repos_url": "https://api.github.com/users/jgoz/repos",
      "events_url": "https://api.github.com/users/jgoz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jgoz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-11-14T23:16:30Z",
    "updated_at": "2014-11-14T23:16:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @jgoz any idea what the problem could be?\n\nYeah, I just took a look at this, and I think the problem is that `row.dedupe` is an absolute path, even if `fullPaths` is disabled. This can make `row.indexDeps` look something like\n\n``` json\n{ \"/path/to/duplicate.js\": 23 }\n```\n\nwhich then gets set as the `deps` for that row [here](https://github.com/substack/node-browserify/blob/932d1488432a72ee1d5e7bee074c110c98df388d/index.js#L597). Later on, these deps will get written to the output bundle.\n\nSo I guess deduplicated rows are leaking full paths into output bundles.\n\nInstead of `row.indexDeps[row.dedupe] = row.dedupeIndex`, could we do `row.indexDeps[row.dedupeIndex] = row.dedupeIndex`? Would something like that even make sense? Maybe @substack could weigh in here.\n\nThese implicit dependencies are necessary for plugins like factor-bundle - without them, it's possible to have a deduplicated row routed to a different bundle from its original row.\n",
    "reactions": {
      "url": "https://api.github.com/repos/browserify/browserify/issues/comments/63144560/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/browserify/browserify/issues/comments/63146715",
    "html_url": "https://github.com/browserify/browserify/issues/951#issuecomment-63146715",
    "issue_url": "https://api.github.com/repos/browserify/browserify/issues/951",
    "id": 63146715,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMTQ2NzE1",
    "user": {
      "login": "jgoz",
      "id": 132233,
      "node_id": "MDQ6VXNlcjEzMjIzMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/132233?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jgoz",
      "html_url": "https://github.com/jgoz",
      "followers_url": "https://api.github.com/users/jgoz/followers",
      "following_url": "https://api.github.com/users/jgoz/following{/other_user}",
      "gists_url": "https://api.github.com/users/jgoz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jgoz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jgoz/subscriptions",
      "organizations_url": "https://api.github.com/users/jgoz/orgs",
      "repos_url": "https://api.github.com/users/jgoz/repos",
      "events_url": "https://api.github.com/users/jgoz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jgoz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-11-14T23:39:54Z",
    "updated_at": "2014-11-14T23:39:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Instead of `row.indexDeps[row.dedupe] = row.dedupeIndex`, could we do `row.indexDeps[row.dedupeIndex] = row.dedupeIndex`? Would something like that even make sense?\n\nTo answer my own question, this could make sense for the case of factor-bundle because it's really only concerned with the values in the `deps` object, not the keys. And in this case, the key doesn't have any real meaning - we're just indicating that there is an implied dependency on the source row.\n\nSo you could even do something like this:\n\n``` js\nif (row.dedupeIndex && row.indexDeps) {\n    row.indexDeps['dedupe'] = row.dedupeIndex;\n}\n```\n\nOr something shorter to save bytes. `dup` or `d`.\n\nThoughts on this approach?\n",
    "reactions": {
      "url": "https://api.github.com/repos/browserify/browserify/issues/comments/63146715/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/browserify/browserify/issues/comments/68048261",
    "html_url": "https://github.com/browserify/browserify/issues/951#issuecomment-68048261",
    "issue_url": "https://api.github.com/repos/browserify/browserify/issues/951",
    "id": 68048261,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MDQ4MjYx",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-12-24T12:06:33Z",
    "updated_at": "2014-12-24T12:06:33Z",
    "author_association": "NONE",
    "body": "Should be all fixed in 8.0.1 thanks to the patch from @jgoz.\n",
    "reactions": {
      "url": "https://api.github.com/repos/browserify/browserify/issues/comments/68048261/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]