[
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/314773954",
    "html_url": "https://github.com/expressjs/express/issues/3363#issuecomment-314773954",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3363",
    "id": 314773954,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDc3Mzk1NA==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T13:46:21Z",
    "updated_at": "2017-07-12T13:46:21Z",
    "author_association": "MEMBER",
    "body": "Hi @chenzx that sounds very strange, and I don't think I've heard of this issue before. I would love to try to debug through it, but need some more information:\r\n\r\nCan you provide a full example app that has this issue and provide instructions for how to trigger the app to get into this state? Thanks for the report!",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/314773954/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/314776451",
    "html_url": "https://github.com/expressjs/express/issues/3363#issuecomment-314776451",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3363",
    "id": 314776451,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDc3NjQ1MQ==",
    "user": {
      "login": "chenzx",
      "id": 622927,
      "node_id": "MDQ6VXNlcjYyMjkyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/622927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chenzx",
      "html_url": "https://github.com/chenzx",
      "followers_url": "https://api.github.com/users/chenzx/followers",
      "following_url": "https://api.github.com/users/chenzx/following{/other_user}",
      "gists_url": "https://api.github.com/users/chenzx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chenzx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chenzx/subscriptions",
      "organizations_url": "https://api.github.com/users/chenzx/orgs",
      "repos_url": "https://api.github.com/users/chenzx/repos",
      "events_url": "https://api.github.com/users/chenzx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chenzx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T13:54:30Z",
    "updated_at": "2017-07-12T14:53:57Z",
    "author_association": "NONE",
    "body": "Sample code is hereï¼š\r\nhttps://github.com/chenzx/node-neteaseCloudMusic-mockserver/blob/master/app.js\r\nTo sum, it's a simple test server which mocks a music service web api,\r\nwhich provides json data response and mp3 download.\r\n\r\nMaybe there is some API mis-use?",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/314776451/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/314795107",
    "html_url": "https://github.com/expressjs/express/issues/3363#issuecomment-314795107",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3363",
    "id": 314795107,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDc5NTEwNw==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T14:53:50Z",
    "updated_at": "2017-07-12T14:53:50Z",
    "author_association": "MEMBER",
    "body": "Thanks for the example!\r\n\r\n> Maybe there is some API mis-use?\r\n\r\nIt's possible, but that code example at almost 500 lines long is too long to really eye-ball for any. Perhaps if you can provide instructions for how to trigger the app to get into the state you described I can at least then just look at a subsection of the app?",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/314795107/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/314804251",
    "html_url": "https://github.com/expressjs/express/issues/3363#issuecomment-314804251",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3363",
    "id": 314804251,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDgwNDI1MQ==",
    "user": {
      "login": "chenzx",
      "id": 622927,
      "node_id": "MDQ6VXNlcjYyMjkyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/622927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chenzx",
      "html_url": "https://github.com/chenzx",
      "followers_url": "https://api.github.com/users/chenzx/followers",
      "following_url": "https://api.github.com/users/chenzx/following{/other_user}",
      "gists_url": "https://api.github.com/users/chenzx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chenzx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chenzx/subscriptions",
      "organizations_url": "https://api.github.com/users/chenzx/orgs",
      "repos_url": "https://api.github.com/users/chenzx/repos",
      "events_url": "https://api.github.com/users/chenzx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chenzx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T15:23:22Z",
    "updated_at": "2017-07-12T15:43:44Z",
    "author_association": "NONE",
    "body": "I guess that, maybe it's due to client browser kernel's max 6 concurrent connections per host limit.\r\nBut if so, the io blocking side should be client, not the express server side.\r\n\r\nAlso i can't understand why `Ctrl+C` will trigger the server's blocking state to unblocked. Maybe some io is been buffered and a signal just flushes it?\r\n\r\nOr maybe it's due to my premature hack, which tries to log the response headers JUST before they will be sent to client, (following the compression middleware's hacks)?",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/314804251/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/314809655",
    "html_url": "https://github.com/expressjs/express/issues/3363#issuecomment-314809655",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3363",
    "id": 314809655,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDgwOTY1NQ==",
    "user": {
      "login": "chenzx",
      "id": 622927,
      "node_id": "MDQ6VXNlcjYyMjkyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/622927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chenzx",
      "html_url": "https://github.com/chenzx",
      "followers_url": "https://api.github.com/users/chenzx/followers",
      "following_url": "https://api.github.com/users/chenzx/following{/other_user}",
      "gists_url": "https://api.github.com/users/chenzx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chenzx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chenzx/subscriptions",
      "organizations_url": "https://api.github.com/users/chenzx/orgs",
      "repos_url": "https://api.github.com/users/chenzx/repos",
      "events_url": "https://api.github.com/users/chenzx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chenzx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T15:40:42Z",
    "updated_at": "2017-07-12T15:44:11Z",
    "author_association": "NONE",
    "body": "I just checked some code, express's res.json() just calls res.send(), which will set Content-Length header field, but if i force to enable gzip compression, then the middleware expression will remove the Content-Length field, and the final response will be `Content-Encoding: gzip` and `Transfer-Encoding: chunked` applied.\r\n\r\nI guess when this happens, server code MUST calls the res.end() in the final app.get(), or the client will continue to wait for data, since there is no `Connection: close` set, the under tcp socket will keep open, which finally reaches the browser's max 6-connection limit?",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/314809655/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/314811279",
    "html_url": "https://github.com/expressjs/express/issues/3363#issuecomment-314811279",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3363",
    "id": 314811279,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDgxMTI3OQ==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T15:45:39Z",
    "updated_at": "2017-07-12T15:45:39Z",
    "author_association": "MEMBER",
    "body": "I'm not sure, as res.send() already calls res.end() internally. I would love to help figure it out, attach a debugger to the app and see where it is going wrong. Perhaps if you can provide instructions for how to trigger the app to get into the state you described I can?",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/314811279/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/314812792",
    "html_url": "https://github.com/expressjs/express/issues/3363#issuecomment-314812792",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3363",
    "id": 314812792,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDgxMjc5Mg==",
    "user": {
      "login": "chenzx",
      "id": 622927,
      "node_id": "MDQ6VXNlcjYyMjkyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/622927?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chenzx",
      "html_url": "https://github.com/chenzx",
      "followers_url": "https://api.github.com/users/chenzx/followers",
      "following_url": "https://api.github.com/users/chenzx/following{/other_user}",
      "gists_url": "https://api.github.com/users/chenzx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chenzx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chenzx/subscriptions",
      "organizations_url": "https://api.github.com/users/chenzx/orgs",
      "repos_url": "https://api.github.com/users/chenzx/repos",
      "events_url": "https://api.github.com/users/chenzx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chenzx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T15:50:20Z",
    "updated_at": "2017-07-12T15:58:06Z",
    "author_association": "NONE",
    "body": "Also there is a difference: the client doesn't set `Connection: close`; to JSON request, but the static mp3 file request is sent by gstreamer module, which set a `Connection: close`, which hopes the server side close the connection after the data fully sent.\r\n\r\nIn a production env, CDN always should follow the client's `Connection: close` hint, but in my testing server script case, i just programmed a fake CDN server which is in the same express app. Maybe the express's server-static middleware doesn't respect the `Connection: close` hint?\r\n\r\nThis is just a guess. Currently i still can't figure out why. Perhaps it's due to NodeJS's non-blocking IO: every IO operation needs a callback notify, but sometime the callback just doesn't trigger, which is hard to track the exact reason.",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/314812792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/314814951",
    "html_url": "https://github.com/expressjs/express/issues/3363#issuecomment-314814951",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3363",
    "id": 314814951,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDgxNDk1MQ==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T15:57:44Z",
    "updated_at": "2017-07-12T15:57:44Z",
    "author_association": "MEMBER",
    "body": "Express.js just sits on top of the Node.js core \"http\" module and it's server. Node.js core is what handles the `Connection: close` stuff. If the connection is not closing, that is likely a bug in the Node.js core itself.",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/314814951/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/314815857",
    "html_url": "https://github.com/expressjs/express/issues/3363#issuecomment-314815857",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3363",
    "id": 314815857,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNDgxNTg1Nw==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-12T16:00:55Z",
    "updated_at": "2017-07-12T16:00:55Z",
    "author_association": "MEMBER",
    "body": "If you are interested, all the logic to handle the connection: close stuff is in https://github.com/nodejs/node/blob/master/lib/_http_outgoing.js",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/314815857/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/320112099",
    "html_url": "https://github.com/expressjs/express/issues/3363#issuecomment-320112099",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3363",
    "id": 320112099,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMDExMjA5OQ==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-03T22:59:12Z",
    "updated_at": "2017-08-03T22:59:12Z",
    "author_association": "MEMBER",
    "body": "Closing since since there hasn't been a follow up. I don't know how to reproduce, and it sounds like a Node.js core bug.",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/320112099/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]