[
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/364795366",
    "html_url": "https://github.com/expressjs/express/issues/3559#issuecomment-364795366",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3559",
    "id": 364795366,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDc5NTM2Ng==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-11T22:25:59Z",
    "updated_at": "2018-02-11T22:25:59Z",
    "author_association": "MEMBER",
    "body": "Since your example code barely does anything with Express, have you tried removing Express from the code to see if the behavior is still there using just the Node.js HTTP server?\r\n\r\nI will be back in a few days and that's the first thing I'm going to try, so figured if you haven't tried it yet, may help move this forward.",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/364795366/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/364795924",
    "html_url": "https://github.com/expressjs/express/issues/3559#issuecomment-364795924",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3559",
    "id": 364795924,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDc5NTkyNA==",
    "user": {
      "login": "DanielRLevine",
      "id": 30180488,
      "node_id": "MDQ6VXNlcjMwMTgwNDg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/30180488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DanielRLevine",
      "html_url": "https://github.com/DanielRLevine",
      "followers_url": "https://api.github.com/users/DanielRLevine/followers",
      "following_url": "https://api.github.com/users/DanielRLevine/following{/other_user}",
      "gists_url": "https://api.github.com/users/DanielRLevine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DanielRLevine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DanielRLevine/subscriptions",
      "organizations_url": "https://api.github.com/users/DanielRLevine/orgs",
      "repos_url": "https://api.github.com/users/DanielRLevine/repos",
      "events_url": "https://api.github.com/users/DanielRLevine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DanielRLevine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-11T22:32:49Z",
    "updated_at": "2018-02-11T22:32:49Z",
    "author_association": "NONE",
    "body": "That is a great suggestion and something that I meant to try before submitting this issue.  I will try it and get back to you!  Thank you for such a quick response!",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/364795924/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/364798130",
    "html_url": "https://github.com/expressjs/express/issues/3559#issuecomment-364798130",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3559",
    "id": 364798130,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDc5ODEzMA==",
    "user": {
      "login": "DanielRLevine",
      "id": 30180488,
      "node_id": "MDQ6VXNlcjMwMTgwNDg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/30180488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DanielRLevine",
      "html_url": "https://github.com/DanielRLevine",
      "followers_url": "https://api.github.com/users/DanielRLevine/followers",
      "following_url": "https://api.github.com/users/DanielRLevine/following{/other_user}",
      "gists_url": "https://api.github.com/users/DanielRLevine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DanielRLevine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DanielRLevine/subscriptions",
      "organizations_url": "https://api.github.com/users/DanielRLevine/orgs",
      "repos_url": "https://api.github.com/users/DanielRLevine/repos",
      "events_url": "https://api.github.com/users/DanielRLevine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DanielRLevine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-11T22:58:56Z",
    "updated_at": "2018-02-11T22:58:56Z",
    "author_association": "NONE",
    "body": "I just ran the same test with the (Express-less) code below, and the problem was the same.  So I can confirm that Express is not the cause of the problem!  This issue can be closed!  I may follow up with the Node.js team.\r\n\r\nThank you for everything that you do to keep Express up and running.  I know that it is an incredible amount of work, and I am very grateful for your contributions over the years.\r\n\r\n```\r\nvar http = require('http');\r\nvar fs = require('fs');\r\nvar path = require('path');\r\nvar BPromise = require(\"bluebird\");\r\n\r\nfunction my_route(req, res) {\r\n    var array = [];\r\n    for (var j = 0; j < 1000; ++j)\r\n        array.push(Math.random());\r\n    array.sort();\r\n\r\n    BPromise.resolve(true)\r\n    .then(function(){\r\n        res.writeHead(200);\r\n        res.end(\"true\", 'utf-8');\r\n    });\r\n}\r\n\r\nhttp.createServer(function (req, res) {\r\n\r\n    my_route(req, res);\r\n\r\n}).listen(1390);\r\n\r\nconsole.log('Server running at http://127.0.0.1:1390/');\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/364798130/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/364798612",
    "html_url": "https://github.com/expressjs/express/issues/3559#issuecomment-364798612",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3559",
    "id": 364798612,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDc5ODYxMg==",
    "user": {
      "login": "kibertoad",
      "id": 1847934,
      "node_id": "MDQ6VXNlcjE4NDc5MzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1847934?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kibertoad",
      "html_url": "https://github.com/kibertoad",
      "followers_url": "https://api.github.com/users/kibertoad/followers",
      "following_url": "https://api.github.com/users/kibertoad/following{/other_user}",
      "gists_url": "https://api.github.com/users/kibertoad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kibertoad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kibertoad/subscriptions",
      "organizations_url": "https://api.github.com/users/kibertoad/orgs",
      "repos_url": "https://api.github.com/users/kibertoad/repos",
      "events_url": "https://api.github.com/users/kibertoad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kibertoad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-11T23:05:16Z",
    "updated_at": "2018-02-11T23:05:16Z",
    "author_association": "NONE",
    "body": "@DanielRLevine Please link issue raised in Node.js repo to this or post back the end results of investigation should it reach any conclusions! Thanks.",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/364798612/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/365312933",
    "html_url": "https://github.com/expressjs/express/issues/3559#issuecomment-365312933",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3559",
    "id": 365312933,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NTMxMjkzMw==",
    "user": {
      "login": "DanielRLevine",
      "id": 30180488,
      "node_id": "MDQ6VXNlcjMwMTgwNDg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/30180488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DanielRLevine",
      "html_url": "https://github.com/DanielRLevine",
      "followers_url": "https://api.github.com/users/DanielRLevine/followers",
      "following_url": "https://api.github.com/users/DanielRLevine/following{/other_user}",
      "gists_url": "https://api.github.com/users/DanielRLevine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DanielRLevine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DanielRLevine/subscriptions",
      "organizations_url": "https://api.github.com/users/DanielRLevine/orgs",
      "repos_url": "https://api.github.com/users/DanielRLevine/repos",
      "events_url": "https://api.github.com/users/DanielRLevine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DanielRLevine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-13T16:04:08Z",
    "updated_at": "2018-02-13T16:04:08Z",
    "author_association": "NONE",
    "body": "@kibertoad It turned out that the problem was the way in which I was using Bluebird. \r\nBy default, Bluebird schedules its promise callbacks in the immediates queue (native promises are scheduled in the \"non-next-tick-microtasks queue\" and Q promises are scheduled in the next tick queue). Because the immediates queue is lower priority than the IO events queue, more and more connections were being accepted while starving Bluebird and thus starving the ability to finish ongoing responses. Conveniently, Bluebird's scheduling is configurable, and a simple call of `BPromise.setScheduler(fn => process.nextTick(fn));` moved Bluebird promises to the next tick queue and resolved the problem.\r\n\r\nMore information about how promise libraries work with respect to the events loop is here: https://jsblog.insiderattack.net/promises-next-ticks-and-immediates-nodejs-event-loop-part-3-9226cbe7a6aa\r\n\r\nHere is the GitHub issue where @benjamingr helped me identify the problem: https://github.com/petkaantonov/bluebird/issues/1503",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/365312933/reactions",
      "total_count": 12,
      "+1": 12,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]