[
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/775916254",
    "html_url": "https://github.com/expressjs/express/issues/4526#issuecomment-775916254",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/4526",
    "id": 775916254,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTkxNjI1NA==",
    "user": {
      "login": "krzysdz",
      "id": 12915102,
      "node_id": "MDQ6VXNlcjEyOTE1MTAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/12915102?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krzysdz",
      "html_url": "https://github.com/krzysdz",
      "followers_url": "https://api.github.com/users/krzysdz/followers",
      "following_url": "https://api.github.com/users/krzysdz/following{/other_user}",
      "gists_url": "https://api.github.com/users/krzysdz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krzysdz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krzysdz/subscriptions",
      "organizations_url": "https://api.github.com/users/krzysdz/orgs",
      "repos_url": "https://api.github.com/users/krzysdz/repos",
      "events_url": "https://api.github.com/users/krzysdz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krzysdz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T12:56:22Z",
    "updated_at": "2021-02-09T12:56:22Z",
    "author_association": "NONE",
    "body": "You can wrap the validation part in [`try...catch`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/try...catch) and return an error status if an exception was thrown.",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/775916254/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/775935861",
    "html_url": "https://github.com/expressjs/express/issues/4526#issuecomment-775935861",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/4526",
    "id": 775935861,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTkzNTg2MQ==",
    "user": {
      "login": "moezemara",
      "id": 39069875,
      "node_id": "MDQ6VXNlcjM5MDY5ODc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/39069875?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/moezemara",
      "html_url": "https://github.com/moezemara",
      "followers_url": "https://api.github.com/users/moezemara/followers",
      "following_url": "https://api.github.com/users/moezemara/following{/other_user}",
      "gists_url": "https://api.github.com/users/moezemara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/moezemara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/moezemara/subscriptions",
      "organizations_url": "https://api.github.com/users/moezemara/orgs",
      "repos_url": "https://api.github.com/users/moezemara/repos",
      "events_url": "https://api.github.com/users/moezemara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/moezemara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T13:29:35Z",
    "updated_at": "2021-02-09T13:29:35Z",
    "author_association": "NONE",
    "body": "> You can wrap the validation part in [`try...catch`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/try...catch) and return an error status if an exception was thrown.\r\n\r\nguess the problem is in the app itself\r\n```js\r\napp.use(express.json())\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/775935861/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/775963511",
    "html_url": "https://github.com/expressjs/express/issues/4526#issuecomment-775963511",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/4526",
    "id": 775963511,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTk2MzUxMQ==",
    "user": {
      "login": "fedeci",
      "id": 38510000,
      "node_id": "MDQ6VXNlcjM4NTEwMDAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/38510000?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fedeci",
      "html_url": "https://github.com/fedeci",
      "followers_url": "https://api.github.com/users/fedeci/followers",
      "following_url": "https://api.github.com/users/fedeci/following{/other_user}",
      "gists_url": "https://api.github.com/users/fedeci/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fedeci/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fedeci/subscriptions",
      "organizations_url": "https://api.github.com/users/fedeci/orgs",
      "repos_url": "https://api.github.com/users/fedeci/repos",
      "events_url": "https://api.github.com/users/fedeci/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fedeci/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T14:06:48Z",
    "updated_at": "2021-02-09T14:06:48Z",
    "author_association": "NONE",
    "body": "Can you post here the failing `json`, please?",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/775963511/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/775966582",
    "html_url": "https://github.com/expressjs/express/issues/4526#issuecomment-775966582",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/4526",
    "id": 775966582,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTk2NjU4Mg==",
    "user": {
      "login": "moezemara",
      "id": 39069875,
      "node_id": "MDQ6VXNlcjM5MDY5ODc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/39069875?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/moezemara",
      "html_url": "https://github.com/moezemara",
      "followers_url": "https://api.github.com/users/moezemara/followers",
      "following_url": "https://api.github.com/users/moezemara/following{/other_user}",
      "gists_url": "https://api.github.com/users/moezemara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/moezemara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/moezemara/subscriptions",
      "organizations_url": "https://api.github.com/users/moezemara/orgs",
      "repos_url": "https://api.github.com/users/moezemara/repos",
      "events_url": "https://api.github.com/users/moezemara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/moezemara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T14:10:39Z",
    "updated_at": "2021-02-09T14:13:35Z",
    "author_association": "NONE",
    "body": "> Can you post here the failing `json`, please?\r\n\r\nliterally anything that is not json \r\nany plain content or any json that has additional comma or even empty requests\r\n\r\nthis one works with no errors\r\n```js\r\n{\r\n    \"email\": \"hello@gmail.com\",\r\n    \"password\": \"bestpassword\"\r\n}\r\n````\r\nthis one gives a fail\r\n```js\r\n{\r\n    \"email\": \"hello@gmail.com\",\r\n    \"password \"bestpassword\"\r\n}\r\n```\r\n![image](https://user-images.githubusercontent.com/39069875/107375620-9d151800-6af1-11eb-85cf-43451aa36bb5.png)\r\n\r\nthe problem is I just want to avoid showing errors to the users whenever they submit wrong formatted json\r\nwant to response with custom message saying its not valid\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/775966582/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/776015318",
    "html_url": "https://github.com/expressjs/express/issues/4526#issuecomment-776015318",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/4526",
    "id": 776015318,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NjAxNTMxOA==",
    "user": {
      "login": "krzysdz",
      "id": 12915102,
      "node_id": "MDQ6VXNlcjEyOTE1MTAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/12915102?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krzysdz",
      "html_url": "https://github.com/krzysdz",
      "followers_url": "https://api.github.com/users/krzysdz/followers",
      "following_url": "https://api.github.com/users/krzysdz/following{/other_user}",
      "gists_url": "https://api.github.com/users/krzysdz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krzysdz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krzysdz/subscriptions",
      "organizations_url": "https://api.github.com/users/krzysdz/orgs",
      "repos_url": "https://api.github.com/users/krzysdz/repos",
      "events_url": "https://api.github.com/users/krzysdz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krzysdz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T15:17:06Z",
    "updated_at": "2021-02-09T15:23:31Z",
    "author_association": "NONE",
    "body": "I didn't see the `app.use(bodyParser.json())`. In such case you may define an [error handler](https://expressjs.com/en/guide/error-handling.html), which will catch this error and either modify this request and call `next()` or respond with a custom error message.\r\n\r\nTry this code as an example:\r\n\r\n```js\r\nconst http = require(\"http\");\r\nconst { URL } = require(\"url\");\r\nconst express = require(\"express\");\r\nconst bodyParser = require(\"body-parser\");\r\n\r\nconst app = express();\r\n\r\napp.use(bodyParser.json()); // Will fail on invalid JSON, express.json is bodyParser.json\r\napp.use((err, req, res, next) => {\r\n\tconsole.error(`An error occured ${err.message}`);\r\n\t// The err.type property is \"entity.parse.failed\" when body-parser fails\r\n\tif (err.type == \"entity.parse.failed\" && req.path == \"/\") {\r\n\t\treq.body = { \"something\": \"something\" }; // Alter the body\r\n\t\tnext(); // Forward the request. Call next(err) to call the next error handler\r\n\t} else {\r\n\t\t// Respond with an error message\r\n\t\tres.status(400).send(\"An error occurred\");\r\n\t}\r\n});\r\n\r\n// This handler gets  called, because next() was called in the error handler above\r\napp.post(\"/\", (req, res) => {\r\n\tconsole.log(\"Hit\");\r\n\tres.send(req.body);\r\n});\r\n\r\nconst invalidJson = \"{\\\"a\\\": b}\";\r\n\r\nconst server = app.listen(0, () => {\r\n\t// This part is just for testing\r\n\tconst url = new URL(`http://localhost:${server.address()?.port}/`);\r\n\tconsole.log(`Listening on ${url}`);\r\n\tconst req = http.request(url, {\r\n\t\tmethod: \"POST\",\r\n\t\theaders: {\r\n\t\t\t\"Content-Type\": \"application/json\",\r\n\t\t\t\"Content-Length\": Buffer.byteLength(invalidJson)\r\n\t\t}\r\n\t}, res => {\r\n\t\tres.on(\"data\", buff => console.log(buff.toString())); // Log the response\r\n\t\tres.on(\"end\", () => {\r\n\t\t\tserver.close(); // Close the server (and exit) after the response was received\r\n\t\t});\r\n\t});\r\n\treq.on(\"error\", (e) => {\r\n\t\tconsole.error(`problem with request: ${e.message}`);\r\n\t});\r\n\treq.write(invalidJson); // Send the POST data\r\n\treq.end();\r\n});\r\n```\r\n\r\nThe output is:\r\n\r\n```\r\nListening on http://localhost:55108/                       # console.log in app.listen\r\nAn error occurred Unexpected token b in JSON at position 6 # console.error in the error handler\r\nHit                                                        # console.log in app.post(\"/\")\r\n{\"something\":\"something\"}                                  # The response\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/776015318/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/776017464",
    "html_url": "https://github.com/expressjs/express/issues/4526#issuecomment-776017464",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/4526",
    "id": 776017464,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NjAxNzQ2NA==",
    "user": {
      "login": "fedeci",
      "id": 38510000,
      "node_id": "MDQ6VXNlcjM4NTEwMDAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/38510000?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fedeci",
      "html_url": "https://github.com/fedeci",
      "followers_url": "https://api.github.com/users/fedeci/followers",
      "following_url": "https://api.github.com/users/fedeci/following{/other_user}",
      "gists_url": "https://api.github.com/users/fedeci/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fedeci/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fedeci/subscriptions",
      "organizations_url": "https://api.github.com/users/fedeci/orgs",
      "repos_url": "https://api.github.com/users/fedeci/repos",
      "events_url": "https://api.github.com/users/fedeci/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fedeci/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T15:20:10Z",
    "updated_at": "2021-02-09T15:20:10Z",
    "author_association": "NONE",
    "body": "@krzysdz since `express@4.16` `express.json()` is the same as `bodyParser.json()`",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/776017464/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/778445101",
    "html_url": "https://github.com/expressjs/express/issues/4526#issuecomment-778445101",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/4526",
    "id": 778445101,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3ODQ0NTEwMQ==",
    "user": {
      "login": "ramos-ph",
      "id": 50644753,
      "node_id": "MDQ6VXNlcjUwNjQ0NzUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/50644753?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ramos-ph",
      "html_url": "https://github.com/ramos-ph",
      "followers_url": "https://api.github.com/users/ramos-ph/followers",
      "following_url": "https://api.github.com/users/ramos-ph/following{/other_user}",
      "gists_url": "https://api.github.com/users/ramos-ph/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ramos-ph/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ramos-ph/subscriptions",
      "organizations_url": "https://api.github.com/users/ramos-ph/orgs",
      "repos_url": "https://api.github.com/users/ramos-ph/repos",
      "events_url": "https://api.github.com/users/ramos-ph/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ramos-ph/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-12T20:45:16Z",
    "updated_at": "2021-02-12T20:45:16Z",
    "author_association": "NONE",
    "body": "The problem appears to be occurring in the `body-parser` dependency.\r\n\r\nAs @fedeci has said, `express.json()` and `bodyParser.json()` are the same.\r\n\r\nFortunately, Express fires events when you make a request. The one that interests you is the `data` event.\r\n\r\nThe callback will always return a Buffer, so remember to parse it to String.\r\n\r\nThe code will look like this:\r\n\r\n```javascript\r\nconst express = require(\"express\");\r\n\r\nconst app = express();\r\n\r\napp.post(\"/route\", (req, res) => {\r\n  req.on(\"data\", (buffer) => {\r\n    const data = buffer.toString();\r\n\r\n    try {\r\n      // will throw an SyntaxError if the JSON is invalid\r\n      return res.send(JSON.parse(data));\r\n    } catch (e) {\r\n      // validate at will\r\n      return res.send(\"JSON file is invalid. \" + e);\r\n    }\r\n  });\r\n});\r\n\r\napp.listen(5000);\r\n```\r\n\r\nHere's how this will look like on success:\r\n![issue2](https://user-images.githubusercontent.com/50644753/107820342-693c2b80-6d59-11eb-9d2b-2ffada082ad0.png)\r\n\r\nAnd how it will look like when the JSON file is invalid:\r\n![issue1](https://user-images.githubusercontent.com/50644753/107820416-8244dc80-6d59-11eb-878b-827ff40948f6.png)\r\n\r\nA pretty simple solution, but I hope it helps! :smile: \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/778445101/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/778447658",
    "html_url": "https://github.com/expressjs/express/issues/4526#issuecomment-778447658",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/4526",
    "id": 778447658,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3ODQ0NzY1OA==",
    "user": {
      "login": "fedeci",
      "id": 38510000,
      "node_id": "MDQ6VXNlcjM4NTEwMDAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/38510000?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fedeci",
      "html_url": "https://github.com/fedeci",
      "followers_url": "https://api.github.com/users/fedeci/followers",
      "following_url": "https://api.github.com/users/fedeci/following{/other_user}",
      "gists_url": "https://api.github.com/users/fedeci/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fedeci/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fedeci/subscriptions",
      "organizations_url": "https://api.github.com/users/fedeci/orgs",
      "repos_url": "https://api.github.com/users/fedeci/repos",
      "events_url": "https://api.github.com/users/fedeci/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fedeci/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-12T20:50:36Z",
    "updated_at": "2021-02-12T20:50:36Z",
    "author_association": "NONE",
    "body": "This should also work to handle errors thrown from `express.json()`\n```js\napp.use(express.json());\napp.use(function(err, req, res, next) {\n  // handle err\n});\n```",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/778447658/reactions",
      "total_count": 4,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/778662765",
    "html_url": "https://github.com/expressjs/express/issues/4526#issuecomment-778662765",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/4526",
    "id": 778662765,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3ODY2Mjc2NQ==",
    "user": {
      "login": "moezemara",
      "id": 39069875,
      "node_id": "MDQ6VXNlcjM5MDY5ODc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/39069875?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/moezemara",
      "html_url": "https://github.com/moezemara",
      "followers_url": "https://api.github.com/users/moezemara/followers",
      "following_url": "https://api.github.com/users/moezemara/following{/other_user}",
      "gists_url": "https://api.github.com/users/moezemara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/moezemara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/moezemara/subscriptions",
      "organizations_url": "https://api.github.com/users/moezemara/orgs",
      "repos_url": "https://api.github.com/users/moezemara/repos",
      "events_url": "https://api.github.com/users/moezemara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/moezemara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-13T19:00:32Z",
    "updated_at": "2021-02-13T19:00:32Z",
    "author_association": "NONE",
    "body": "> This should also work to handle errors thrown from `express.json()`\r\n> \r\n> ```js\r\n> app.use(express.json());\r\n> app.use(function(err, req, res, next) {\r\n>   // handle err\r\n> });\r\n> ```\r\n\r\nThis solution worked well\r\nThanks guys",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/778662765/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]