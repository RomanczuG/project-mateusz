[
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/460093769",
    "html_url": "https://github.com/expressjs/express/issues/3871#issuecomment-460093769",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3871",
    "id": 460093769,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDA5Mzc2OQ==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-03T22:13:24Z",
    "updated_at": "2019-02-03T22:19:30Z",
    "author_association": "MEMBER",
    "body": "So the first thing I would ask is if you could try this same metholodigy on an example app without Express (just using the Node.js built-in HTTP sever, which Express.js uses) so we can start tracking down perhaps what is introducing this behavior. The following script should do this for you, if you can validate it on your setup and report back:\r\n```js\r\n'use strict';\r\n\r\nconst http = require('http');\r\nconst memwatch = require('node-memwatch');\r\n\r\nlet hd;\r\nlet count = 0;\r\n\r\n(() => {\r\n    const server = http.createServer();\r\n\r\n    server.on('request', (req, res) => {\r\n        if (hd) {\r\n            const diff = hd.end();\r\n            count += 1;\r\n            diff.change.details.forEach(detail => {\r\n                const delta = detail['+'] - detail['-'];\r\n                console.log(`${count},${detail.what},${detail['+']},${delta}`);\r\n            });\r\n            hd = undefined;\r\n        } else {\r\n            hd = new memwatch.HeapDiff();\r\n        }\r\n\r\n        res.end('Memory Test');\r\n    });\r\n\r\n    const port = process.env.SERVER_PORT || 3001;\r\n    const listener = server.listen(port);\r\n    console.log(`Memory test listening on port ${port}.`);\r\n\r\n    return listener;\r\n})();\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/460093769/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/460094573",
    "html_url": "https://github.com/expressjs/express/issues/3871#issuecomment-460094573",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3871",
    "id": 460094573,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDA5NDU3Mw==",
    "user": {
      "login": "daveisfera",
      "id": 1686193,
      "node_id": "MDQ6VXNlcjE2ODYxOTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1686193?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/daveisfera",
      "html_url": "https://github.com/daveisfera",
      "followers_url": "https://api.github.com/users/daveisfera/followers",
      "following_url": "https://api.github.com/users/daveisfera/following{/other_user}",
      "gists_url": "https://api.github.com/users/daveisfera/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/daveisfera/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daveisfera/subscriptions",
      "organizations_url": "https://api.github.com/users/daveisfera/orgs",
      "repos_url": "https://api.github.com/users/daveisfera/repos",
      "events_url": "https://api.github.com/users/daveisfera/events{/privacy}",
      "received_events_url": "https://api.github.com/users/daveisfera/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-03T22:23:09Z",
    "updated_at": "2019-02-03T22:23:09Z",
    "author_association": "NONE",
    "body": "I'll setup some long term tests with both of these scripts to get some better data, but the initial/quick tests seem to show the same behavior with the script you provided. Obviously, it would be best to wait and see the results of the long term test, but I believe that that seems to indicate that this is an issue in `node` or the `http` module itself.",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/460094573/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/460097256",
    "html_url": "https://github.com/expressjs/express/issues/3871#issuecomment-460097256",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3871",
    "id": 460097256,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDA5NzI1Ng==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-03T22:59:29Z",
    "updated_at": "2019-02-03T22:59:29Z",
    "author_association": "MEMBER",
    "body": "Hi @daveisfera thanks for getting back. After posting the above I tried as well and saw the same numbers you described, and that it seems like they are the same with and without Express.js. That makes sense in a way since the objects you highlighted are not directly created by Express.js in a way I'm aware of, at least, and there are definately timers in use in the Node.js HTTP server implementation (which would be in use in both those above scripts).\r\n\r\nI look forward to hearing back regarding your longer tests. If you are seeing it without Express.js, the Node.js issue tracker is here: https://github.com/nodejs/node/issues . There are folks there with much greater knowledge than I about the internals of Node.js.",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/460097256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/460443363",
    "html_url": "https://github.com/expressjs/express/issues/3871#issuecomment-460443363",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3871",
    "id": 460443363,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDQ0MzM2Mw==",
    "user": {
      "login": "daveisfera",
      "id": 1686193,
      "node_id": "MDQ6VXNlcjE2ODYxOTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1686193?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/daveisfera",
      "html_url": "https://github.com/daveisfera",
      "followers_url": "https://api.github.com/users/daveisfera/followers",
      "following_url": "https://api.github.com/users/daveisfera/following{/other_user}",
      "gists_url": "https://api.github.com/users/daveisfera/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/daveisfera/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daveisfera/subscriptions",
      "organizations_url": "https://api.github.com/users/daveisfera/orgs",
      "repos_url": "https://api.github.com/users/daveisfera/repos",
      "events_url": "https://api.github.com/users/daveisfera/events{/privacy}",
      "received_events_url": "https://api.github.com/users/daveisfera/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-04T22:44:57Z",
    "updated_at": "2019-02-04T22:44:57Z",
    "author_association": "NONE",
    "body": "The way I'm doing the monitoring must not be a good measure, because here's my updated script and it shows similar \"growth\" in both Node 8 and 10 (for Node 8 I used `memwatch-next`).\r\n\r\n```\r\n'use strict';\r\n\r\nconst http = require('http');\r\nconst memwatch = require('node-memwatch');\r\n\r\nlet hd = new memwatch.HeapDiff();\r\nlet count = 0;\r\nconst totals = {};\r\n\r\n(() => {\r\n    const server = http.createServer();\r\n\r\n    server.on('request', (req, res) => {\r\n        const hd2 = new memwatch.HeapDiff();\r\n        const diff = hd.end();\r\n        hd = hd2;\r\n        count += 1;\r\n        if (count > 10) {\r\n            diff.change.details.forEach(detail => {\r\n                const delta = detail['+'] - detail['-'];\r\n                if (delta !== 0) {\r\n                    if (detail.what in totals) {\r\n                        totals[detail.what] += delta;\r\n                    } else {\r\n                        totals[detail.what] = delta;\r\n                    }\r\n                    if (delta > 0 && totals[detail.what] > 1) {\r\n                        console.log(`${count},${detail.what},${delta},${totals[detail.what]}`);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        res.end('Memory Test');\r\n    });\r\n\r\n    const port = process.env.SERVER_PORT || 3001;\r\n    const listener = server.listen(port);\r\n    console.log(`Memory test listening on port ${port}.`);\r\n\r\n    return listener;\r\n})();\r\n```\r\n\r\nAny other recommendations on how I can diagnose the cause of this issue?",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/460443363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/460446359",
    "html_url": "https://github.com/expressjs/express/issues/3871#issuecomment-460446359",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3871",
    "id": 460446359,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDQ0NjM1OQ==",
    "user": {
      "login": "daveisfera",
      "id": 1686193,
      "node_id": "MDQ6VXNlcjE2ODYxOTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1686193?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/daveisfera",
      "html_url": "https://github.com/daveisfera",
      "followers_url": "https://api.github.com/users/daveisfera/followers",
      "following_url": "https://api.github.com/users/daveisfera/following{/other_user}",
      "gists_url": "https://api.github.com/users/daveisfera/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/daveisfera/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daveisfera/subscriptions",
      "organizations_url": "https://api.github.com/users/daveisfera/orgs",
      "repos_url": "https://api.github.com/users/daveisfera/repos",
      "events_url": "https://api.github.com/users/daveisfera/events{/privacy}",
      "received_events_url": "https://api.github.com/users/daveisfera/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-04T22:55:31Z",
    "updated_at": "2019-02-04T22:55:31Z",
    "author_association": "NONE",
    "body": "Oh, and I forgot to mention that in the long term stress tests, it's actually `Array` and `Code` as the `what` values that are increasing regularly and I see that in both Node 8 and Node 10.",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/460446359/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/460468689",
    "html_url": "https://github.com/expressjs/express/issues/3871#issuecomment-460468689",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3871",
    "id": 460468689,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDQ2ODY4OQ==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-05T00:32:37Z",
    "updated_at": "2019-02-05T00:32:37Z",
    "author_association": "MEMBER",
    "body": "Hi @daveisfera ! Really I'm not that experienced in this type of thing. What I usually have done in the past to general success is take periodic memory dumps, and compare the objects retained between the dumps and see (a) what is in the objects (for example `Code` objects typically have the source string of the function) and (b) where they are rooted.\r\n\r\nNode.js internals have a mix of JS / C++ interactions, which can make it a bit more complicated. If you're seeing this happen without Express.js involved, it may be worth engaging the Node.js core issue tracker inked above to get their expertise as well.",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/460468689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/460470111",
    "html_url": "https://github.com/expressjs/express/issues/3871#issuecomment-460470111",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3871",
    "id": 460470111,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDQ3MDExMQ==",
    "user": {
      "login": "daveisfera",
      "id": 1686193,
      "node_id": "MDQ6VXNlcjE2ODYxOTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1686193?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/daveisfera",
      "html_url": "https://github.com/daveisfera",
      "followers_url": "https://api.github.com/users/daveisfera/followers",
      "following_url": "https://api.github.com/users/daveisfera/following{/other_user}",
      "gists_url": "https://api.github.com/users/daveisfera/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/daveisfera/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daveisfera/subscriptions",
      "organizations_url": "https://api.github.com/users/daveisfera/orgs",
      "repos_url": "https://api.github.com/users/daveisfera/repos",
      "events_url": "https://api.github.com/users/daveisfera/events{/privacy}",
      "received_events_url": "https://api.github.com/users/daveisfera/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-05T00:39:04Z",
    "updated_at": "2019-02-05T00:39:04Z",
    "author_association": "NONE",
    "body": "`memwatch.HeapDiff()` is supposed to be doing what you described (i.e. take a snapshot of the heap at 2 times and output the changes) and it definitely appears to not be `express` related, so I'll open an issue with `node`. Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/460470111/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/expressjs/express/issues/comments/460919214",
    "html_url": "https://github.com/expressjs/express/issues/3871#issuecomment-460919214",
    "issue_url": "https://api.github.com/repos/expressjs/express/issues/3871",
    "id": 460919214,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDkxOTIxNA==",
    "user": {
      "login": "dougwilson",
      "id": 67512,
      "node_id": "MDQ6VXNlcjY3NTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/67512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dougwilson",
      "html_url": "https://github.com/dougwilson",
      "followers_url": "https://api.github.com/users/dougwilson/followers",
      "following_url": "https://api.github.com/users/dougwilson/following{/other_user}",
      "gists_url": "https://api.github.com/users/dougwilson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dougwilson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dougwilson/subscriptions",
      "organizations_url": "https://api.github.com/users/dougwilson/orgs",
      "repos_url": "https://api.github.com/users/dougwilson/repos",
      "events_url": "https://api.github.com/users/dougwilson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dougwilson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-06T06:52:44Z",
    "updated_at": "2019-02-06T06:52:44Z",
    "author_association": "MEMBER",
    "body": "Right, but I meant actually open the snapshots in something like Chrome and diif them. You can explore those retained objects to actually see where they are being rooted and what their contents, which would help track down what is happening. ",
    "reactions": {
      "url": "https://api.github.com/repos/expressjs/express/issues/comments/460919214/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]